 ---
layout: post
title: hystrix简介
category: hystrix
tags:  熔断，hystrix
description:  熔断
--- 

#### 概念
Hystic是一个熔断框架，类似于电路线路中的保险丝。
在分布式系统中，存在服务之间的依赖，Hystic 是一个能通过添加容错机制帮助开发者控制两个服务之间的通信。Hystrix 通过隔离服务防止服务错误传播，提供失败调用来保持一个系统的弹性。

#### Hystix 目的
- 通过第三方客户端 保护和控制 服务访问延迟和错误。
- 防止错误在复杂的分布式系统中传播
- 快速失败和快速恢复 
- 服务调用的回退机制和平滑降级以及监控，报警和控制。


#### Hystix能解决什么问题
一个分布式系统应用有许多的服务依赖，这些服务在某些时刻可能不可用或者调用失败，如果应用没有隔离这些失败，将会有宕机的风险。

举个例子一个分布式应用依赖30个服务，比如每个服务只有99.99%时间是可用的。那么
99.9930 = 99.7%。也就是说对于这个应用，10亿次请求，会有300万次失败，实际生产环境中可能情况更差,如果不能保持整个系统的弹性，即使所有的服务比较稳定，只有0.01%的不可用时间也会导致每个月会有一个小时的服务不可用。
然而Hystric能解决这个问题。



##### 举个例子
当一个应用所有的依赖服务都正常的时候，如下图，通过网络来访问服务。一个用户请求需要同时访问服务 A
H,I,P

![](http://7x00ae.com1.z0.glb.clouddn.com/18-1-20/20269517.jpg)

当某一个服务延迟比较严重，会阻塞所有的用户请求。
如果用户请求速度在50 req/s 时候 因为 网络延迟，所有的用户请求线程会阻塞。

![](http://7x00ae.com1.z0.glb.clouddn.com/18-1-20/49848998.jpg)



当大量的流量进来时，一个后端服务如果变得延迟严重，会在一秒造成整个系统负载达到饱和。
在通过网络调用，分布式程序中的每个点都可能是潜在故障的来源。 比调用失败更严重的是，两个服务之间的延迟变得严重，会消耗线程或者操作系统的资源，从而扩散到整个系统。


![](http://7x00ae.com1.z0.glb.clouddn.com/18-1-20/37990033.jpg)

##### 设计原则
- 防止任何单个服务消耗所有的容器线程
- 通过快速失败而不是排队来较少系统负载。
- 提供回退机制，使用用户不受故障影响。
- 使用隔离技术(如隔板、泳道和断路器模式)来限制任何一个服务的负面影响。
- 通过实时指标统计，监控，和报警来优化 发现服务不可用时间。
- 通过修改Hystrix的 低延迟的配置和属性来优化服务恢复的时间，这样使得你能无延迟实时修改和操作服务。
- 不仅仅是在网络中而且在整个客户端的调用链中防止失败。




####  设计目的

- 使用一种命令模式，把任何服务调用包装成一种能隔离线程池的HystrixCommand 或HystrixObservableCommand 对象。
- 服务超时后耗时远比定义的阀值更长，。服务调用可以设置一个默认的超时时间，这样远比99.5%的服务性能更好。
- 每个依赖服务都会有自己的线程池，互不干扰。
- 记录服务执行成功，失败，拒绝，超时的次数
- 如果一段时间内服务调用错误的百分比超过一定的阀值，会触发熔断器，停止调用此服务。
- 当服务调用超时，错误或者被熔断后，会执行fallBack逻辑
- 实时监控和统计。


当你的应用使用Hystrix，上图所示的体系结构变为下图所示，每个依赖服务之间都会被隔离开，互不影响，

当服务之间延迟发生，或资源饱和，会执行fallBack逻辑，
fallBack逻辑根据不同的故障做出不同的响应。

![](http://7x00ae.com1.z0.glb.clouddn.com/18-1-20/65292301.jpg)





#### 原理图
![](http://7x00ae.com1.z0.glb.clouddn.com/18-1-20/50556439.jpg)